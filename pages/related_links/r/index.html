
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SDRE HPC wiki for end users/researchers">
      
      
      
      
      
      
      <link rel="icon" href="../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>R - Sensitive Data Research Environment Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
      <link rel="stylesheet" href="../../../stylesheets/button.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#r" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Sensitive Data Research Environment Documentation" class="md-header__button md-logo" aria-label="Sensitive Data Research Environment Documentation" data-md-component="logo">
      
  <img src="../../../images/ua-logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sensitive Data Research Environment Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              R
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../basics/overview/" class="md-tabs__link">
          
  
  Basics and General

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../high_perf_computing/using_modules/" class="md-tabs__link">
          
  
  High Performance Computing

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../storage_data/storage_overview/" class="md-tabs__link">
          
  
  Storage and Data

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../software_catalog/available_software/" class="md-tabs__link">
          
  
  Software Catalog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../testing/" class="md-tabs__link">
        
  
    
  
  Related Links

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../training/connecting_to_hpc_video/" class="md-tabs__link">
          
  
  Training/Learning Resources

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../system_status/system_status/" class="md-tabs__link">
        
  
    
  
  System Status

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../placeholder.md" class="md-tabs__link">
        
  
    
  
  FAQs

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Sensitive Data Research Environment Documentation" class="md-nav__button md-logo" aria-label="Sensitive Data Research Environment Documentation" data-md-component="logo">
      
  <img src="../../../images/ua-logo.png" alt="logo">

    </a>
    Sensitive Data Research Environment Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Basics and General
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Basics and General
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/introduction_to_hpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduciton to HPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/account_request/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Account Request
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/connect_to_hpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to HPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/system_specifications/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Specifications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/linux_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/consultation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Consultation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/sdre_user_policy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SDRE User Policy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../basics/ackowledging_sdre/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledging SDRE
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    High Performance Computing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            High Performance Computing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/using_modules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/running_jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Slurm for running jobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/using_gpus_with_slurm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using GPUs with Slurm
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/job_arrays/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Job arrays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/resubmitting_jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resubmitting jobs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../high_perf_computing/standard_software_environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standard Software Environment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Storage and Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Storage and Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage_data/storage_overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storage Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage_data/data_transfer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Transfer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage_data/quota_management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quota Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storage_data/data_governance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Governance
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Software Catalog
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Software Catalog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_catalog/available_software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software Lists
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_catalog/available_python_wheels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Available Python wheels
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_catalog/easybuild/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Easybuild
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_catalog/virtual_environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Creating and using virtual environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../software_catalog/apptainer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Apptainer Container
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Related Links
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Training/Learning Resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Training/Learning Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../training/connecting_to_hpc_video/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connecting to HPC
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../training/slurm_job_submission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Slurm Job Submission
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../training/rc_bootcamp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Research Computing Bootcamp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../system_status/system_status/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Status
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../placeholder.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="r"><strong>R</strong></h1>
<hr />
<!-- Reference: https://docs.alliancecan.ca/wiki/R -->

<p>R is a system for statistical computation and graphics. It consists of a language plus a runtime environment with graphics, a debugger, access to certain system functions, and the ability to run programs stored in script files.</p>
<p>Even though R was not developed for high-performance computing (HPC), its popularity with scientists from a variety of disciplines, including engineering, mathematics, statistics, bioinformatics, etc. makes it an essential tool on HPC installations dedicated to academic research. Features such as C extensions, byte-compiled code and parallelization allow for reasonable performance in single-node jobs. Thanks to Râ€™s modular nature, users can customize the R functions available to them by installing packages from the Comprehensive R Archive Network (<a href="https://cran.r-project.org/">CRAN</a>) into their home directories.</p>
<h2 id="the-r-interpreter"><strong>The R interpreter</strong></h2>
<hr />
<p>You need to begin by loading an R module; there will typically be several versions available and you can see a list of all of them using the command</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ module spider r
</code></pre></div>
<p>You can load a particular R module using a command like</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ module load gcc/9.3.0 r/4.0.2
</code></pre></div>
<p>For more on this, see <a href="/pages/high_perf_computing/using_modules/">Using modules</a>.</p>
<p>Now you can start the R interpreter and type R code inside that environment:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ R
R version 4.0.2 (2020-06-22) -- &quot;Taking Off Again&quot;
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type &#39;license()&#39; or &#39;licence()&#39; for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type &#39;contributors()&#39; for more information and
&#39;citation()&#39; on how to cite R or R packages in publications.

Type &#39;demo()&#39; for some demos, &#39;help()&#39; for on-line help, or
&#39;help.start()&#39; for an HTML browser interface to help.
Type &#39;q()&#39; to quit R.

&gt; values &lt;- c(3,5,7,9)
&gt; values[1]
[1] 3
&gt; q()
</code></pre></div>
<p>To execute an R script non-interactively, use <code>Rscript</code> with the file containing the R commands as an argument:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ Rscript computation.R
</code></pre></div>
<p><code>Rscript</code> will automatically pass scripting-appropriate options <code>--slave</code> and <code>--no-restore</code> to the R interpreter. These also imply the <code>--no-save</code> option, preventing the creation of useless workspace files on exit.</p>
<p>Note that <strong>any calculations lasting more than two or three minutes should not be run on the login node</strong>. They should be run via the job scheduler.</p>
<p>A simple job script looks like this:</p>
<p>ðŸ“¥<a download="job1.sh" href="/files/related_links/r/job1.sh">click to download</a></p>
<div class="highlight"><span class="filename">job.sh</span><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=def-someacct   # replace this with your own account</span>
<span class="c1">#SBATCH --mem-per-cpu=2000M      # memory; default unit is megabytes</span>
<span class="c1">#SBATCH --time=0-00:15           # time (DD-HH:MM)</span>
module<span class="w"> </span>load<span class="w"> </span>gcc/9.3.0<span class="w"> </span>r/4.0.2<span class="w">              </span><span class="c1"># Adjust version and add the gcc module used for installing packages.</span>

Rscript<span class="w"> </span>computation.R
</code></pre></div>
<p>See <a href="/pages/high_perf_computing/running_jobs/">Running jobs</a> for more information.</p>
<h2 id="installing-r-packages"><strong>Installing R packages</strong></h2>
<hr />
<h3 id="installpackages"><strong>install.packages()</strong></h3>
<p>To install packages from CRAN, you can use <code>install.packages</code> in an interactive R session on login node. Since the compute nodes on most clusters do not have access to the Internet, installing R packages in a batch or interactive job is not possible. Many R packages are developed using the GNU family of compilers so we recommend that you load a <code>gcc</code> module before trying to install any R packages. Use the same version of the <code>gcc</code> for all packages you install.</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ module load gcc/9.3.0 r/4.0.2
</code></pre></div>
<p><strong>Installing for a specific R version</strong></p>
<p>For example, to install the <code>sp</code> package that provides classes and methods for spatial data, use the following command on a login node:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ R
[...]
&gt; install.packages(&#39;sp&#39;, repos=&#39;https://cloud.r-project.org/&#39;)
</code></pre></div>
<p>If the argument <code>repos</code> is not specified, you will be asked to select an appropriate mirror for download. Ideally, it will be geographically close to the cluster you're working on.</p>
<p>Some packages require defining the environment variable <code>TMPDIR</code> before installing.</p>
<p><strong>Installing for one or many R versions</strong></p>
<p>Specify the local installation directory according to the R module that is currently loaded.</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ mkdir -p ~/.local/R/$EBVERSIONR/
[name@server ~]$ export R_LIBS=~/.local/R/$EBVERSIONR/
</code></pre></div>
<p>Install the package.</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ R -e &#39;install.packages(&quot;sp&quot;, repos=&quot;https://cloud.r-project.org/&quot;)&#39;
</code></pre></div>
<p>In your submission script, you then have to load the desired R module and set the local library directory with <code>export R_LIBS=~/.local/R/$EBVERSIONR/</code>.</p>
<h3 id="dependencies"><strong>Dependencies</strong></h3>
<p>Some packages depend on external libraries which are already installed on our clusters. If the library you need is listed at <a href="/pages/software_catalog/available_software/">Available software</a>, then load the appropriate module before installing the package that requires it.</p>
<p>For example, the package <code>rgdal</code> requires a library called <code>gdal</code>. Running <code>module spider gdal/2.2.1</code> shows that it requires <code>nixpkgs</code> and <code>gcc</code> modules. If you took the advice above to load <code>gcc</code> then both these should already be loaded. Verify this by running</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ module list
</code></pre></div>
<p>If any package fails to install, be sure to read the error message carefully as it might give you details concerning additional modules you need to load. See <a href="/pages/high_perf_computing/using_modules/">Using modules</a> for more on the <code>module</code> family of commands.</p>
<h3 id="downloaded-packages"><strong>Downloaded packages</strong></h3>
<p>To install a package that you downloaded (i.e. not using <code>install.packages()</code>), you can install it as follows. Assuming the package is named <code>archive_package.tgz</code>, run the following command in a shell:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ R CMD INSTALL -l &#39;path for your local (home) R library&#39; archive_package.tgz
</code></pre></div>
<h2 id="using-system-calls-in-r"><strong>Using system calls in R</strong></h2>
<p>Using the R command <code>system()</code> you can execute commands in the ambient environment from inside R. On our clusters, this can lead to problems because R will give an incorrect value to the environment variable <code>LD_LIBRARY_PATH</code>. You can avoid this problem by using the syntax <code>system("LD_LIBRARY_PATH=$RSNT_LD_LIBRARY_PATH &lt;my system call&gt;")</code> in your R system calls.</p>
<h2 id="passing-arguments-to-r-scripts"><strong>Passing arguments to R scripts</strong></h2>
<hr />
<p>Sometimes it can be useful to pass parameters as arguments to R scripts, to avoid having to either change the R script for every job or having to manage multiple copies of otherwise identical scripts. This can be useful for specifying the names for input- or output files, as well as specifying numerical parameters. For example, instead of specifying the name of an input file and/or a numerical parameter like this</p>
<div class="highlight"><pre><span></span><code>filename = &quot;input.csv&quot;
iterations = 5
</code></pre></div>
<p>and changing the code every time either of these changes, parameters can be passed to the R-script when starting it:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ Rscript myscript.R  input_1.csv  5
</code></pre></div>
<p>and the next</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$ Rscript myscript.R  input_2.csv  10
</code></pre></div>
<p>The following example expects exactly two arguments. The first one should be a string which will be used for the variable "name" and the second one should be an integer for the variable "number".</p>
<p>ðŸ“¥<a download="arguments_test.R" href="/files/related_links/r/arguments_test.R">click to download</a></p>
<div class="highlight"><pre><span></span><code><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">commandArgs</span><span class="p">(</span><span class="n">trailingOnly</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>

<span class="c1"># test if there is at least two arguments: if not, return an error</span>
<span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">&lt;</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">stop</span><span class="p">(</span><span class="s">&quot;At least two arguments must be supplied (&#39;name&#39; (text) and &#39;numer&#39; (integer) )&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">call.</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">name</span><span class="w">      </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">                </span><span class="c1"># read first argument as string</span>
<span class="n">number</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="w"> </span><span class="n">args</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c1"># read second argument as integer</span>

<span class="nf">print</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;Processing with name:&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&#39; and number:&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="p">,</span><span class="s">&quot;&#39;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p">))</span>
</code></pre></div>
<p>This script can be used like this:</p>
<div class="highlight"><pre><span></span><code>[name@server ~]$  Rscript arguments_test.R  Hello  42
[1] &quot;Processing with name:&#39;Hello&#39; and number:&#39;42&#39;&quot;
</code></pre></div>
<h2 id="exploiting-parallelism-in-r"><strong>Exploiting parallelism in R</strong></h2>
<hr />
<p>The processors on our clusters are quite ordinary. What makes these supercomputers super is that you have access to thousands of CPU cores with a high-performance network. In order to take advantage of this hardware, you must run code "in parallel." However, note that prior to investing a lot of time and effort in parallelizing your R code, you should first ensure that your serial implementation is as efficient as possible. As an interpreted language, the use of loops in R, and especially nested loops, constitutes a significant performance bottleneck. Whenever possible you should try to use vectorized forms of R functions and more functional elements of the R programming language like the family of <code>apply</code> functions and the <code>ifelse</code> function. This will frequently offer you a far better performance gain by eliminating a loop altogether instead of simply parallelizing the (slow) execution of this loop across several CPU cores.</p>
<p>The <a href="https://cran.r-project.org/web/views/HighPerformanceComputing.html">CRAN Task View on High-Performance and Parallel Computing with R</a> describes a bewildering collection of interrelated R packages for parallel computing. For an excellent overview and advice, see the October 2023 Compute Ontario colloquium <a href="https://education.scinet.utoronto.ca/course/view.php?id=1333">"High-Performance R"</a> (<a href="https://education.scinet.utoronto.ca/mod/resource/view.php?id=2887">slides</a>).</p>
<p>The following subsections contain some further notes and examples.</p>
<p><strong>A note on terminology:</strong> In most of our documentation the term 'node' refers to an individual machine, also called a 'host', and a collection of such nodes makes up a 'cluster'. In a lot of R documentation however, the term 'node' refers to a worker process and a 'cluster' is a collection of such processes. As an example, consider the following quote, "Following snow, a pool of worker processes listening via sockets for commands from the master is called a 'cluster' of nodes."[1].</p>
<h3 id="doparallel-and-foreach"><strong>doParallel and foreach</strong></h3>
<p><strong>Usage</strong></p>
<p>Foreach can be considered as a unified interface for all backends (i.e. doMC, doMPI, doParallel, doRedis, etc.). It works on all platforms, assuming that the backend works. doParallel acts as an interface between foreach and the parallel package and can be loaded alone. There are some known efficiency issues when using foreach to run a very large number of very small tasks. Therefore, keep in mind that the following code is not the best example of an optimized use of the foreach() call but rather that the function chosen was kept at a minimum for demonstration purposes.</p>
<p>You must register the backend by feeding it the number of cores available. If the backend is not registered, foreach will assume that the number of cores is 1 and will proceed to go through the iterations serially.</p>
<p>The general method to use foreach is:</p>
<ol>
<li>to load both foreach and the backend package;</li>
<li>to register the backend;</li>
<li>to call foreach() by keeping it on the same line as the %do% (serial) or %dopar% operator.</li>
</ol>
<p><strong>Running</strong></p>
<ol>
<li>Place your R code in a script file, in this case the file is called <code>test_foreach.R</code>.</li>
</ol>
<p>ðŸ“¥<a download="test_foreach.R" href="/files/related_links/r/test_foreach.R">click to download</a></p>
<div class="highlight"><span class="filename">test_foreach.R</span><pre><span></span><code><span class="c1"># library(foreach) # optional if using doParallel</span>
<span class="nf">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span><span class="w"> </span><span class="c1">#</span>

<span class="c1"># a very simple function</span>
<span class="n">test_func</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kr">function</span><span class="p">(</span><span class="n">var1</span><span class="p">,</span><span class="w"> </span><span class="n">var2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1"># some heavy workload</span>
<span class="w">    </span><span class="n">sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">0</span>
<span class="w">    </span><span class="kr">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">3141593</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">var1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">sin</span><span class="p">(</span><span class="n">var2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kr">return</span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">sum</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1"># we will iterate over two sets of values, you can modify this to explore the mechanism of foreach</span>
<span class="n">var1.v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">8</span><span class="p">)</span>
<span class="n">var2.v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">length.out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span>

<span class="c1"># Use the environment variable SLURM_CPUS_PER_TASK to set the number of cores.</span>
<span class="c1"># This is for SLURM. Replace SLURM_CPUS_PER_TASK by the proper variable for your system.</span>
<span class="c1"># Avoid manually setting a number of cores.</span>
<span class="n">ncores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&quot;SLURM_CPUS_PER_TASK&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="nf">registerDoParallel</span><span class="p">(</span><span class="n">cores</span><span class="o">=</span><span class="n">ncores</span><span class="p">)</span><span class="c1"># Shows the number of Parallel Workers to be used</span>
<span class="nf">print</span><span class="p">(</span><span class="n">ncores</span><span class="p">)</span><span class="w"> </span><span class="c1"># this how many cores are available, and how many you have requested.</span>
<span class="nf">getDoParWorkers</span><span class="p">()</span><span class="c1"># you can compare with the number of actual workers</span>

<span class="c1"># be careful! foreach() and %dopar% must be on the same line!</span>
<span class="nf">foreach</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">var1.v</span><span class="p">,</span><span class="w"> </span><span class="n">.combine</span><span class="o">=</span><span class="n">rbind</span><span class="p">)</span><span class="w"> </span><span class="o">%:%</span><span class="w"> </span><span class="nf">foreach</span><span class="p">(</span><span class="n">var2</span><span class="o">=</span><span class="n">var2.v</span><span class="p">,</span><span class="w"> </span><span class="n">.combine</span><span class="o">=</span><span class="n">rbind</span><span class="p">)</span><span class="w"> </span><span class="o">%dopar%</span><span class="w"> </span><span class="p">{</span><span class="nf">test_func</span><span class="p">(</span><span class="n">var1</span><span class="o">=</span><span class="n">var1</span><span class="p">,</span><span class="w"> </span><span class="n">var2</span><span class="o">=</span><span class="n">var2</span><span class="p">)}</span>
</code></pre></div>
<ol>
<li>Copy the following content in a job submission script called <code>job_foreach.sh</code>:</li>
</ol>
<p>ðŸ“¥<a download="job_foreach.sh" href="/files/related_links/r/job_foreach.sh">click to download</a></p>
<div class="highlight"><span class="filename">job_foreach.sh</span><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=def-someacct   # replace this with your supervisors account</span>
<span class="c1">#SBATCH --nodes=1                # number of node MUST be 1</span>
<span class="c1">#SBATCH --cpus-per-task=4        # number of processes</span>
<span class="c1">#SBATCH --mem-per-cpu=2048M      # memory; default unit is megabytes</span>
<span class="c1">#SBATCH --time=0-00:15           # time (DD-HH:MM)</span>
<span class="c1">#SBATCH --mail-user=yourname@someplace.com # Send email updates to you or someone else</span>
<span class="c1">#SBATCH --mail-type=ALL          # send an email in all cases (job started, job ended, job aborted)</span>

module<span class="w"> </span>load<span class="w"> </span>gcc/9.3.0<span class="w"> </span>r/4.0.2
<span class="nb">export</span><span class="w"> </span><span class="nv">R_LIBS</span><span class="o">=</span>~/local/R_libs/
R<span class="w"> </span>CMD<span class="w"> </span>BATCH<span class="w"> </span>--no-save<span class="w"> </span>--no-restore<span class="w"> </span>test_foreach.R
</code></pre></div>
<ol>
<li>Submit the job with:</li>
</ol>
<div class="highlight"><pre><span></span><code>[name@server ~]$ sbatch job_foreach.sh
</code></pre></div>
<p>For more on submitting jobs, see <a href="/pages/high_perf_computing/running_jobs/">Running jobs</a>.</p>
<h3 id="doparallel-and-makecluster"><strong>doParallel and makeCluster</strong></h3>
<p><strong>Usage</strong></p>
<p>You must register the backend by feeding it the nodes name multiplied by the desired number of processes. For instance, with two nodes (node1 and node2) and two processes, we would create a cluster composed of : <code>node1 node1 node2 node2</code> hosts. The <em>PSOCK</em> cluster type will run commands through SSH connections into the nodes.</p>
<p><strong>Running</strong></p>
<ol>
<li>Place your R code in a script file, in this case the file is called <code>test_makecluster.R</code>.</li>
</ol>
<p>ðŸ“¥<a download="test_makecluster.R" href="/files/related_links/r/test_makecluster.R">click to download</a></p>
<div class="highlight"><span class="filename">test_makecluster.R</span><pre><span></span><code><span class="nf">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span>

<span class="c1"># Create an array from the NODESLIST environnement variable</span>
<span class="n">nodeslist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unlist</span><span class="p">(</span><span class="nf">strsplit</span><span class="p">(</span><span class="nf">Sys.getenv</span><span class="p">(</span><span class="s">&quot;NODESLIST&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">split</span><span class="o">=</span><span class="s">&quot; &quot;</span><span class="p">))</span>

<span class="c1"># Create the cluster with the nodes name. One process per count of node name.</span>
<span class="c1"># nodeslist = node1 node1 node2 node2, means we are starting 2 processes on node1, likewise on node2.</span>
<span class="n">cl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">makeCluster</span><span class="p">(</span><span class="n">nodeslist</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;PSOCK&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nf">registerDoParallel</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>

<span class="c1"># Compute (Source : https://cran.r-project.org/web/packages/doParallel/vignettes/gettingstartedParallel.pdf)</span>
<span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">iris</span><span class="p">[</span><span class="nf">which</span><span class="p">(</span><span class="n">iris</span><span class="p">[,</span><span class="m">5</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&quot;setosa&quot;</span><span class="p">),</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="p">)]</span>
<span class="n">trials</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">10000</span>

<span class="nf">foreach</span><span class="p">(</span><span class="nf">icount</span><span class="p">(</span><span class="n">trials</span><span class="p">),</span><span class="w"> </span><span class="n">.combine</span><span class="o">=</span><span class="n">cbind</span><span class="p">)</span><span class="w"> </span><span class="o">%dopar%</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">    </span><span class="n">ind</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sample</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="w">    </span><span class="n">result1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">glm</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">~</span><span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">family</span><span class="o">=</span><span class="nf">binomial</span><span class="p">(</span><span class="n">logit</span><span class="p">))</span>
<span class="w">    </span><span class="nf">coefficients</span><span class="p">(</span><span class="n">result1</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="c1"># Don&#39;t forget to release resources</span>
<span class="nf">stopCluster</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</code></pre></div>
<ol>
<li>Copy the following content in a job submission script called <code>job_makecluster.sh</code>:</li>
</ol>
<p>ðŸ“¥<a download="job_makecluster.sh" href="/files/related_links/r/job_makecluster.sh">click to download</a></p>
<div class="highlight"><span class="filename">job_makecluster.sh</span><pre><span></span><code><span class="c1">#!/bin/bash</span>
<span class="c1">#SBATCH --account=def-someacct  # replace this with your supervisors account</span>
<span class="c1">#SBATCH --ntasks=4              # number of processes</span>
<span class="c1">#SBATCH --mem-per-cpu=512M      # memory; default unit is megabytes</span>
<span class="c1">#SBATCH --time=00:05:00         # time (HH:MM:SS)</span>

<span class="n">module</span><span class="w"> </span><span class="n">load</span><span class="w"> </span><span class="n">gcc</span><span class="o">/</span><span class="m">9.3</span><span class="n">.</span><span class="m">0</span><span class="w"> </span><span class="n">r</span><span class="o">/</span><span class="m">4.0</span><span class="n">.</span><span class="m">2</span>

<span class="c1"># Export the nodes names. </span>
<span class="c1"># If all processes are allocated on the same node, NODESLIST contains : node1 node1 node1 node1</span>
<span class="c1"># Cut the domain name and keep only the node name</span>
<span class="n">export</span><span class="w"> </span><span class="n">NODESLIST</span><span class="o">=$</span><span class="p">(</span><span class="n">echo</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">srun</span><span class="w"> </span><span class="n">hostname</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">cut</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="w"> </span><span class="s">&#39;.&#39;</span><span class="p">))</span>
<span class="n">R</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">test_makecluster.R</span>
</code></pre></div>
<p>In the above example the scheduler might place all four processes on just one node. This is okay, but if you wish to prove that the same job works even if the processes happen to be placed on different nodes, then add the line <code>#SBATCH --ntasks-per-node=2</code></p>
<ol>
<li>Submit the job with:</li>
</ol>
<div class="highlight"><pre><span></span><code>[name@server ~]$ sbatch job_makecluster.sh
</code></pre></div>
<p>For more information on submitting jobs, see <a href="/pages/high_perf_computing/running_jobs/">Running jobs</a>.</p>
<h3 id="rmpi"><strong>Rmpi</strong></h3>
<p><strong>Installing</strong></p>
<p>This next procedure installs <a href="https://cran.r-project.org/web/packages/Rmpi/index.html">Rmpi</a>, an interface (wrapper) to MPI routines, which allow R to run in parallel.</p>
<ol>
<li>See the available R modules by running:</li>
</ol>
<div class="highlight"><pre><span></span><code>module spider r
</code></pre></div>
<ol>
<li>Select the R version and load the required Open MPI module. This example uses Open MPI version 4.0.3 to spawn the processes correctly.</li>
</ol>
<div class="highlight"><pre><span></span><code>module load gcc/11.3.0
module load r/4.2.1
module load openmpi/4.1.4
</code></pre></div>
<ol>
<li>Download the <a href="https://cran.r-project.org/web/packages/Rmpi/index.html">latest Rmpi version</a>; change the version number to whatever is desired.</li>
</ol>
<div class="highlight"><pre><span></span><code>wget https://cran.r-project.org/src/contrib/Rmpi_0.6-9.2.tar.gz
</code></pre></div>
<ol>
<li>
<p>Specify the directory where you want to install the package files; you must have write permission for this directory. The directory name can be changed if desired.
<div class="highlight"><pre><span></span><code>mkdir -p ~/local/R_libs/
export R_LIBS=~/local/R_libs/
</code></pre></div></p>
</li>
<li>
<p>Run the install command.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><code>R CMD INSTALL --configure-args=&quot;--with-Rmpi-include=$EBROOTOPENMPI/include   --with-Rmpi-libpath=$EBROOTOPENMPI/lib --with-Rmpi-type=&#39;OPENMPI&#39; &quot; Rmpi_0.6-9.2.tar.gz
</code></pre></div>
<p>Again, carefully read any error message that comes up when packages fail to install and load the required modules to ensure that all your packages are successfully installed.</p>
<p><strong>Running</strong></p>
<ol>
<li>Place your R code in a script file, in this case the file is called <code>test.R</code>.</li>
</ol>
<p>ðŸ“¥<a download="test.R" href="/files/related_links/r/test.R">click to download</a></p>
<div class="highlight"><span class="filename">test.R</span><pre><span></span><code><span class="c1">#Tell all slaves to return a message identifying themselves.</span>
<span class="nf">library</span><span class="p">(</span><span class="s">&quot;Rmpi&quot;</span><span class="p">)</span>
<span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;TEST mpi.universe.size() =  %i&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">mpi.universe.size</span><span class="p">())</span>
<span class="n">ns</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mpi.universe.size</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span>
<span class="nf">sprintf</span><span class="p">(</span><span class="s">&quot;TEST attempt to spawn %i slaves&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">)</span>
<span class="nf">mpi.spawn.Rslaves</span><span class="p">(</span><span class="n">nslaves</span><span class="o">=</span><span class="n">ns</span><span class="p">)</span>
<span class="nf">mpi.remote.exec</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="s">&quot;I am&quot;</span><span class="p">,</span><span class="nf">mpi.comm.rank</span><span class="p">(),</span><span class="s">&quot;of&quot;</span><span class="p">,</span><span class="nf">mpi.comm.size</span><span class="p">()))</span>
<span class="nf">mpi.remote.exec</span><span class="p">(</span><span class="nf">paste</span><span class="p">(</span><span class="nf">mpi.comm.get.parent</span><span class="p">()))</span>
<span class="c1">#Send execution commands to the slaves</span>
<span class="n">x</span><span class="o">&lt;-</span><span class="m">5</span>
<span class="c1">#These would all be pretty correlated one would think</span>
<span class="n">x</span><span class="o">&lt;-</span><span class="nf">mpi.remote.exec</span><span class="p">(</span><span class="n">rnorm</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
<span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">x</span>
<span class="nf">mpi.close.Rslaves</span><span class="p">()</span>
<span class="nf">mpi.quit</span><span class="p">()</span>
</code></pre></div>
<ol>
<li>Copy the following content in a job submission script called <code>job.sh</code>:</li>
</ol>
<p>ðŸ“¥<a download="job2.sh" href="/files/related_links/r/job2.sh">click to download</a></p>
<div class="highlight"><span class="filename">job.sh</span><pre><span></span><code><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --account=def-someacct   # replace this with your supervisors account</span>
<span class="c1">#SBATCH --ntasks=5               # number of MPI processes</span>
<span class="c1">#SBATCH --mem-per-cpu=2048M      # memory; default unit is megabytes</span>
<span class="c1">#SBATCH --time=0-00:15           # time (DD-HH:MM)</span>

module<span class="w"> </span>load<span class="w"> </span>gcc/11.3.0
module<span class="w"> </span>load<span class="w"> </span>r/4.2.1
module<span class="w"> </span>load<span class="w"> </span>openmpi/4.1.4
<span class="nb">export</span><span class="w"> </span><span class="nv">R_LIBS</span><span class="o">=</span>~/local/R_libs/
mpirun<span class="w"> </span>-np<span class="w"> </span><span class="m">1</span><span class="w"> </span>R<span class="w"> </span>CMD<span class="w"> </span>BATCH<span class="w"> </span>test.R<span class="w"> </span>test.txt
</code></pre></div>
<ol>
<li>Submit the job with:</li>
</ol>
<div class="highlight"><pre><span></span><code>sbatch job.sh
</code></pre></div>
<p>For more on submitting jobs, see <a href="/pages/high_perf_computing/running_jobs/">Running jobs</a>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.expand", "navigation.path", "navigation.instant", "navigation.top", "toc.integrate", "toc.follow", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "content.code.select", "content.download", "content.tooltips", "content.tabs", "grid", null], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js"></script>
      
        <script src="../../../javascripts/tablesort.js"></script>
      
        <script src="../../../javascripts/accordition.js"></script>
      
    
  </body>
</html>